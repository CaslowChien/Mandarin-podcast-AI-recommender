<!DOCTYPE html>
<html lang="en">
<head>
Â Â <meta charset="UTF-8" />
Â Â <title>AI Podcast Recommender</title>
Â Â <style>
Â Â Â Â body { font-family: Arial; margin: 30px; background: #fafafa; }
Â Â Â Â h1 { color: #333; }
Â Â Â Â .result {
Â Â Â Â Â Â background: white;
Â Â Â Â Â Â padding: 12px;
Â Â Â Â Â Â border-radius: 8px;
Â Â Â Â Â Â box-shadow: 0 2px 5px rgba(0,0,0,0.1);
Â Â Â Â Â Â margin-bottom: 15px;
Â Â Â Â Â Â display: flex;
Â Â Â Â Â Â gap: 12px;
Â Â Â Â Â Â align-items: flex-start;
Â Â Â Â }
Â Â Â Â .result img {
Â Â Â Â Â Â width: 90px;
Â Â Â Â Â Â height: 90px;
Â Â Â Â Â Â border-radius: 10px;
Â Â Â Â Â Â object-fit: cover;
Â Â Â Â }
Â Â Â Â .result a {
Â Â Â Â Â Â font-size: 18px;
Â Â Â Â Â Â font-weight: bold;
Â Â Â Â Â Â color: #0077cc;
Â Â Â Â Â Â text-decoration: none;
Â Â Â Â }
Â Â Â Â .result a:hover { text-decoration: underline; }
Â Â Â Â input {
Â Â Â Â Â Â width: 95%;
Â Â Â Â Â Â padding: 12px;
Â Â Â Â Â Â border-radius: 6px;
Â Â Â Â Â Â border: 1px solid #ccc;
Â Â Â Â Â Â font-size: 16px;
Â Â Â Â Â Â margin-bottom: 20px;
Â Â Â Â }
Â Â </style>
</head>

<body>
Â Â <h1>ðŸŽ§ Podcast Recommender</h1>
Â Â <input id="search" placeholder="Search for a topic..." />
Â Â <div id="results"></div>

Â Â <script type="module">
Â Â Â Â import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';
Â Â Â Â import * as webllm from 'https://esm.run/@mlc-ai/web-llm';

Â Â Â Â async function main() {
Â Â Â Â Â Â // Embedding model
Â Â Â Â Â Â const embedder = await pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');

Â Â Â Â Â Â // Load your final JSON
Â Â Â Â Â Â const res = await fetch('podcast_embeddings.json');
Â Â Â Â Â Â const podcasts = await res.json();

Â Â Â Â Â Â // LLM for silent reranking
Â Â Â Â Â Â const engine = await webllm.CreateWebWorkerMLCEngine(
Â Â Â Â Â Â Â Â new Worker('https://esm.run/@mlc-ai/web-llm/worker'),
Â Â Â Â Â Â Â Â { model: 'Llama-3.2-1B-Instruct-q4f32_1-MLC' }
Â Â Â Â Â Â );

Â Â Â Â Â Â document.getElementById("search").addEventListener("input", async (e) => {
Â Â Â Â Â Â Â Â const query = e.target.value.trim();
Â Â Â Â Â Â Â Â if (!query) return;

Â Â Â Â Â Â Â Â // Step 1: Vector search
Â Â Â Â Â Â Â Â const queryEmb = await embedder(query, { pooling: 'mean', normalize: true });

Â Â Â Â Â Â Â Â const results = podcasts.map(p => ({
Â Â Â Â Â Â Â Â Â Â ...p,
Â Â Â Â Â Â Â Â Â Â score: cosineSimilarity(queryEmb.data[0], p.embedding)
Â Â Â Â Â Â Â Â }));

Â Â Â Â Â Â Â Â const top10 = results.sort((a,b) => b.score - a.score).slice(0, 10);

Â Â Â Â Â Â Â Â // Step 2: LLM silent rerank
Â Â Â Â Â Â Â Â const prompt = `
User query: "${query}"
Choose the best 5 podcasts that match this query.
Return ONLY a JSON array of episode_id values. No explanation.

${top10.map(p => `EP:${p.episode_id}, Title:${p.title}, Desc:${p.description}`).join('\n')}
`;

Â Â Â Â Â Â Â Â const reply = await engine.chat.completions.create({
Â Â Â Â Â Â Â Â Â Â messages: [{ role: "user", content: prompt }],
Â Â Â Â Â Â Â Â Â Â temperature: 0.1
Â Â Â Â Â Â Â Â });

Â Â Â Â Â Â Â Â const raw = reply.choices[0].message.content;
Â Â Â Â Â Â Â Â const topIds = extractIds(raw);

Â Â Â Â Â Â Â Â // Fallback: if LLM returns nothing, use top 5 vector results
Â Â Â Â Â Â Â Â const final5 = topIds.length
Â Â Â Â Â Â Â Â Â Â ? top10.filter(p => topIds.includes(p.episode_id))
Â Â Â Â Â Â Â Â Â Â : top10.slice(0, 5);

Â Â Â Â Â Â Â Â displayResults(final5);
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â function cosineSimilarity(a, b) {
Â Â Â Â Â Â let dot=0, normA=0, normB=0;
Â Â Â Â Â Â for (let i=0; i<a.length; i++){
Â Â Â Â Â Â Â Â dot += a[i] * b[i];
Â Â Â Â Â Â Â Â normA += a[i] ** 2;
Â Â Â Â Â Â Â Â normB += b[i] ** 2;
Â Â Â Â Â Â }
Â Â Â Â Â Â return dot / (Math.sqrt(normA) * Math.sqrt(normB));
Â Â Â Â }

Â Â Â Â function extractIds(text) {
Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â const json = JSON.parse(text.match(/\[.*\]/s)[0]);
Â Â Â Â Â Â Â Â return json.map(x => x.toString());
Â Â Â Â Â Â } catch {
Â Â Â Â Â Â Â Â return [];
Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â function displayResults(results) {
Â Â Â Â Â Â const container = document.getElementById("results");

Â Â Â Â Â Â container.innerHTML = results.map(r => `
Â Â Â Â Â Â Â Â <div class="result">
Â Â Â Â Â Â Â Â Â Â <img src="${r.image}" alt="cover">
Â Â Â Â Â Â Â Â Â Â <div>
Â Â Â Â Â Â Â Â Â Â Â Â <a href="${r.link}" target="_blank">${r.title}</a><br>
Â Â Â Â Â Â Â Â Â Â Â Â <small style="color:#666;">${r.lastUpdate}</small><br><br>
Â Â Â Â Â Â Â Â Â Â Â Â <div>${r.description ? r.description.slice(0, 200) + "..." : ""}</div>
Â Â Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â Â Â </div>
Â Â Â Â Â Â `).join('');
Â Â Â Â }

Â Â Â Â main();
Â Â </script>
</body>
</html>
